```{r source survival_semi_parameters, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
suppressPackageStartupMessages(source("setup.R"))
```

# Mod√®le Cox

On se place dans le cadre du mod√®le de Cox. La fonction de risque conditionnelle s‚Äô√©crit

\[
h(t \mid X) = h_0(t)\exp(\beta^T X),
\]

o√π :

- \(X = (X_1, X_2, \dots, X_p)^T\) est le vecteur de covariables de dimension \(p \times 1\),
- \(\beta = (\beta_1, \beta_2, \dots, \beta_p)^T\) est le vecteur de coefficients de r√©gression.
- \( h_0(t) \) est le risque instantan√© d'√©v√®nement quand toutes les covariables valent z√©ros.

Consid√©rons :

- \(D\) le nombre d‚Äô√©v√©nements **divorce** observ√©s parmi les \(n\) sujets de l‚Äô√©tude,
- \(T_1 < T_2 < \dots < T_D\) les temps distincts de divorce,
- \(R(T_i)\) l‚Äôensemble des individus encore √† risque de divorce juste avant le temps \(T_i\) (toujours mari√©s √† \(T_i^-\)).

Le mod√®le suppose que le rapport des risques entre deux individus \(i\) et \(j\) est

\[
\frac{\lambda(t \mid X_i)}{\lambda(t \mid X_j)}
= \exp\left(\beta^T (X_i - X_j)\right),
\]

ce qui traduit l‚Äôhypoth√®se de **risques proportionnels**.



```{r survival_semi_parameters_0, echo = FALSE, fig.align='center'}
# --- Donn√©es
time <- data.brute$marriage_duration_years
event <- data.brute$divorced

cox_all <- coxph(
  Surv(time, event) ~ . - divorced - marriage_duration_years,
  data = data.brute
)

summary(cox_all)

```

La compatibilit√© religieuse appara√Æt comme un facteur protecteur : les couples o√π la personne n‚Äôest pas religieuse ont un hazard ratio de 0.849, ce qui correspond √† une r√©duction du risque de divorce d‚Äôenviron 15 % par rapport √† la cat√©gorie de r√©f√©rence. Cet effet est statistiquement significatif (z = -2.27, p = 0.0232), indiquant que l‚Äôabsence de religion r√©duit l√©g√®rement mais de mani√®re significative le risque de rupture.

La qualit√© de la communication entre partenaires a un effet protecteur important. Chaque augmentation d‚Äôune unit√© du score de communication est associ√©e √† un hazard ratio de 0.953, soit une diminution du risque de divorce d‚Äôenviron 4,7 %, avec une tr√®s forte significativit√© statistique (z = -4.26, p = 2.0e-05). Cela indique que de meilleures comp√©tences en communication r√©duisent le risque de divorce.

Le stress financier augmente le risque de divorce : chaque unit√© suppl√©mentaire dans le niveau de stress financier est associ√©e √† un hazard ratio de 1.028, soit une augmentation du risque de divorce d‚Äôenviron 2,8 %, avec z = 2.80 et p = 0.0051.

Les probl√®mes de sant√© mentale accroissent √©galement le risque de divorce. Les couples o√π un partenaire pr√©sente des probl√®mes de sant√© mentale ont un hazard ratio de 1.174, ce qui correspond √† une augmentation du risque de divorce d‚Äôenviron 17,4 %, z = 2.95, p = 0.0031.

L‚Äôinfid√©lit√© est un facteur de risque majeur : les couples o√π l‚Äôinfid√©lit√© est survenue ont un hazard ratio de 1.270, soit une augmentation du risque de divorce d‚Äôenviron 27 %, z = 4.07, p = 4.6e-05.

L‚Äôhistorique de violence domestique est le facteur le plus impactant observ√© : les couples ayant un tel historique pr√©sentent un hazard ratio de 1.443, correspondant √† une augmentation du risque de divorce d‚Äôenviron 44,3 %, avec z = 4.18 et p = 2.9e-05.

Enfin, le niveau de confiance est fortement protecteur : chaque unit√© suppl√©mentaire dans le score de confiance est associ√©e √† un hazard ratio de 0.949, soit une r√©duction du risque de divorce d‚Äôenviron 5,1 %, avec une significativit√© tr√®s √©lev√©e (z = -4.60, p = 4.1e-06).

Ces r√©sultats montrent que les facteurs relationnels (communication, confiance, infid√©lit√©, violence domestique), psychologiques (probl√®mes de sant√© mentale) et financiers (stress financier) ont un impact significatif sur la stabilit√© du mariage. Les variables avec HR < 1 r√©duisent le risque de divorce, tandis que celles avec HR > 1 l‚Äôaugmentent.

```{r survival_semi_parameters_1}
# Cr√©ation du dataframe synth√©tique
df_significatives <- data.frame(
  Variable = c(
    "Religious Compatibility (Not Religious)",
    "Communication Score",
    "Financial Stress Level",
    "Mental Health Issues",
    "Infidelity Occurred",
    "Domestic Violence History",
    "Trust Score"
  ),
  HR = c(0.849, 0.953, 1.028, 1.174, 1.270, 1.443, 0.949),
  Pourcentage_Risque = c(
    "-15%", "-4.7%", "+2.8%", "+17.4%", "+27%", "+44.3%", "-5.1%"
  ),
  Interpretation = c(
    "Non religieuse ‚Üí r√©duction du risque de divorce",
    "Meilleure communication ‚Üí r√©duction du risque",
    "Stress financier ‚Üë ‚Üí risque de divorce ‚Üë",
    "Probl√®mes de sant√© mentale ‚Üë ‚Üí risque ‚Üë",
    "Infid√©lit√© ‚Üí risque de divorce ‚Üë",
    "Historique de violence ‚Üí risque ‚Üë",
    "Confiance ‚Üë ‚Üí r√©duction du risque de divorce"
  )
)

# Coloration dynamique de la colonne Pourcentage_Risque
df_significatives$Pourcentage_Risque <- sapply(df_significatives$Pourcentage_Risque, function(x) {
  value <- as.numeric(gsub("[+%]", "", x))  # extraire valeur num√©rique
  color <- ifelse(value > 0, "red", "green")
  cell_spec(x, color = color, bold = TRUE)
})

# Cr√©ation du tableau
kable(df_significatives, "html", escape = FALSE,
      caption = "üìä Covariables significatives du mod√®le de Cox") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE) %>%
  column_spec(1, bold = TRUE, color = "black", background = c("#D6EAF8", "#F9E79F", "#FDEDEC", "#D6EAF8", "#F9E79F", "#FDEDEC", "#D6EAF8")) %>%
  column_spec(2, width = "3cm") %>%
  column_spec(3, width = "3cm") %>%
  column_spec(4, width = "8cm") %>%
  row_spec(0, bold = TRUE, color = "white", background = "#2C3E50")
```